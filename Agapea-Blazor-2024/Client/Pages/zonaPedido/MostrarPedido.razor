@page "/Tienda/MostrarPedido"
@using Agapea_Blazor_2024.Client.Models.Services.Interfaces

@inject IStorageService storageSvc
@inject NavigationManager navigate

<div class="container">
    <div class="row">
        <!-- columna para datos del pedido: direccion envio, facturacion, datos pago-->
        <div class="col-7"></div>

        <!-- columna para elementos del pedido, subtotal, gastos envio y total -->
        <div class="col-5">
            <div class="container">
                <div class="row">
                    <div class="col"><h5><strong>Resumen de la cesta</strong></h5></div>
                </div>
                @foreach (ItemPedido item in this._listaItems)
                {
                    <div class="row">
                        <div class="col">
                            <ElementoPedido elemento="@item" operarItemEvent="@ModificarItemPedido"></ElementoPedido>
                        </div>
                    </div>
                }
                <hr />

                <div class="row">
                    <div class="col-10"><p><strong>Subtotal:</strong></p></div>
                    <div class="col-2"><p style="color:red">0 €</p></div>
                </div>

                <div class="row">
                    <div class="col-10"><p><strong>Gastos de envio y Gestion:</strong></p></div>
                    <div class="col-2"><p style="color:red">0 €</p></div>
                </div>

                <div class="row" style="background: grey">
                    <div class="col-10"><p><strong>Total a pagar:</strong></p></div>
                    <div class="col-2"><p style="color:red">0 €</p></div>
                </div>

                <div class="row">
                    <small>El periodo de entrega es <span style="color:forestgreen">de 24 a 48 Horas</span></small>
                </div>

                <div class="row d-flex flex-row justify-content-between">
                    <a class="btn btn-light"
                       onclick="@(()=>this.navigate.NavigateTo("/Tienda/Libros"))">
                        <i class="fa-solid fa-book"></i> Seguir Comprando
                    </a>

                    <a class="btn btn-primary">
                        <i class="fa-solid fa-truck"></i> Finalizar Pedido
                    </a>
                </div>

            </div>
        </div>
    </div>
</div>


@code {
    public List<ItemPedido> _listaItems { get; set; } = new List<ItemPedido>();

    protected override void OnInitialized()
    {
        
        this._listaItems = this.storageSvc.RecuperarElementosPedido();
        Console.WriteLine("Pedido: " + this._listaItems);
    }

    public void ModificarItemPedido(KeyValuePair<String, ItemPedido> datos)
    {
        this.storageSvc.OperarElementosPedido(datos.Value.LibroItem, datos.Value.CantidadItem, datos.Key);
        StateHasChanged();
    }
}
